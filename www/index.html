<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Gilgamech Hosting</title>	
		<script src="https://www.Sparational.com/Sparational.js"></script>
<script type="text/javascript">
<!-- SCRIPTS GO HERE -->
var testData = [
	{
		"description":"Testing validation.",
		"method": "GET",
		"URI": "https://gilresume.s3.amazonaws.com/test.txt",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Serve index.html as root.",
		"method": "PUT",
		"URI": "http://localhost/",
		"headers":"",
		"body": {"URI":"/","Action":"fs~/index.html","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":""},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"LB between 2 websites",
		"method": "PUT",
		"URI": "http://localhost/Gilgamech.html",
		"headers":"",
		"body": {"URI":"/Gilgamech.html","Action":"uri~GET~https://www.Gilgamech.com,https://gilgamech.neocities.org~0","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":""},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"increment test",
		"method": "PUT",
		"URI": "http://localhost/increment",
		"headers":"",
		"body": {"URI":"/increment","Action":"data~%increment+1","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"increment test 2",
		"method": "GET",
		"URI": "http://localhost/increment",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":2,
		"notes":""
	},
	{
		"description":"increment test 3",
		"method": "GET",
		"URI": "http://localhost/increment",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":3,
		"notes":""
	},
	{
		"description":"decrement test",
		"method": "PUT",
		"URI": "http://localhost/decrement",
		"headers":"",
		"body": {"URI":"/decrement","Action":"data~%decrement-1","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1000000},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"decrement test 2",
		"method": "GET",
		"URI": "http://localhost/decrement",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":999999,
		"notes":""
	},
	{
		"description":"decrement test 3",
		"method": "GET",
		"URI": "http://localhost/decrement",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":999998,
		"notes":""
	},
	{
		"description":"URI validation",
		"method": "PUT",
		"URI": "http://localhost/test",
		"headers":"",
		"body":  {"URI":"/decrement","Action":"data~%decrement-1","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1000000},
		"shouldPass":"fail",
		"testItem":"StatusCode",
		"expectedOutput":" Error: Bad Request",
		"notes":""
	},
	{
		"description":"404 test",
		"method": "GET",
		"URI": "http://localhost/badURI",
		"headers":"",
		"body": "",
		"shouldPass":"fail",
		"testItem":"StatusCode",
		"expectedOutput":" Error: Not Found",
		"notes":""
	},
	{
		"description":"404 test 2",
		"method": "GET",
		"URI": "http://localhost/badURI",
		"headers":"",
		"body": "",
		"shouldPass":"fail",
		"testItem":"StatusCode",
		"expectedOutput":" Error: Not Found",
		"notes":""
	},
	{
		"description":"Multiple users",
		"method": "PUT",
		"URI": "http://localhost/test2",
		"headers":"",
		"body":  {"URI":"/test2","Action":"data~%test2/2","Owner":"Gilgamech","AccessList":{"Gilgamech":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"],"Everyone":["GET", "HEAD", "OPTIONS"]},"notes":"","Data":1000000},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Multiple users 2",
		"method": "GET",
		"URI": "http://localhost/test2",
		"headers":"",
		"body": "",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"no Everyone",
		"method": "PUT",
		"URI": "http://localhost/test3",
		"headers":"",
		"body":  {"URI":"/test3","Action":"data~%test3/2","Owner":"Gilgamech","AccessList":{"Gilgamech":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1000000},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"no Everyone 2",
		"method": "GET",
		"URI": "http://localhost/test3",
		"headers":"",
		"body": "",
		"shouldPass":"fail",
		"testItem":"StatusCode",
		"expectedOutput":" Error: Method Not Allowed",
		"notes":""
	},
	{
		"description":"Owner test",
		"method": "PUT",
		"URI": "http://localhost/test4",
		"headers":"",
		"body":  {"URI":"/test4","Action":"data~%test4*2","Owner":"Gilgamech","AccessList":{"BobbyTables":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Owner test 2",
		"method": "GET",
		"URI": "http://localhost/test4",
		"headers":"",
		"body": "",
		"shouldPass":"fail",
		"testItem":"StatusCode",
		"expectedOutput":" Error: Method Not Allowed",
		"notes":""
	},
	{
		"description":"Website header setup",
		"method": "POST",
		"URI": "http://localhost/header.html",
		"headers":"",
		"body": "(gc .\\ToRemove\\header.html)",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Website footer setup",
		"method": "POST",
		"URI": "http://localhost/footer.html",
		"headers":"",
		"body": "(gc .\\ToRemove\\footer.html)",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Data concatenation",
		"method": "PUT",
		"URI": "http://localhost/page.html",
		"headers":"",
		"body":  {"URI":"/page.html","Action":"data~%header.html <div class=\"textBubbleBG\"><h1>We Are Number 1!</h1></div> %footer.html","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":""},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"Login setup",
		"method": "PUT",
		"URI": "http://localhost/login",
		"headers":"",
		"body":  {"URI":"/login","Action":"login","Owner":"Gilgamech","AccessList":{"Everyone":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":""},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":"%token."
	},
	{
		"description":"Login test",
		"method": "POST",
		"URI": "http://localhost/login",
		"headers":"",
		"body":  {"username":"Gilgamech","password":"testingPass"},
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":"Bearer %token",
		"notes":""
	},
	{
		"description":"Multiple users 3",
		"method": "PUT",
		"URI": "http://localhost/test2",
		"headers":"Bearer %token",
		"body": {"URI":"/test2","Action":"data~%test2/2","Owner":"Gilgamech","AccessList":{"Gilgamech":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"],"Everyone":["GET", "HEAD", "OPTIONS"]},"notes":"","Data":1000000},
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"no Everyone 3",
		"method": "PUT",
		"URI": "http://localhost/test3",
		"body": {"URI":"/test3","Action":"data~%test3/2","Owner":"Gilgamech","AccessList":{"Gilgamech":["GET", "HEAD", "OPTIONS", "POST", "PUT", "DELETE", "MERGE"]},"notes":"","Data":1000000},
		"headers":"Bearer %token",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	},
	{
		"description":"no Everyone 4",
		"method": "GET",
		"URI": "http://localhost/test3",
		"body": "",
		"headers":"Bearer %token",
		"shouldPass":"pass",
		"testItem":"content",
		"expectedOutput":500000,
		"notes":""
	},
	{
		"description":"Owner test 3",
		"method": "GET",
		"URI": "http://localhost/test4",
		"body": "",
		"headers":"Bearer %token",
		"shouldPass":"pass",
		"testItem":"StatusCode",
		"expectedOutput":200,
		"notes":""
	}
]

function draw() {
	var passCounter = 0;
	var passItems = 0;
	var PFList = [];
	var testCounter = 0;
	var token = "" //need to store in a cookie.
	var totalItems = testData.length;
	
	for (var i = 0;i < totalItems; i++) {

		let addLine = "<li>[<span class='%passfail%'>%PASSFAIL%</span>] Test "+i+": "+testData[i].description +" ["+testData[i].URI.replace("http://localhost","")+"]- Expected: "+testData[i].expectedOutput+" - Got: %response%</li>";
		let nextStepsLine = ""
		let webResponse = ""

		let headers = testData[i].headers
		let testItem = testData[i].testItem
		let shouldPass = testData[i].shouldPass
		let expectedOutput = testData[i].expectedOutput

		if (token != "") {
			headers.token = testData[i].headers.replace("%token",token);
		} //end if token
		
		webRequest(testData[i].method,testData[i].URI,function(content){
			console.log(content)
			var data = "";
			testCounter++;

			if (content.split(" ")[0] == "Bearer") {
				console.log("Bearer")
				content = content.replace(content.split(" ")[1],"%token")
				token = content.split(" ")[1];
			}
			
			switch (testItem) {
			case "content":
				data = content;
				break;
			case "StatusCode":
				data = 200
				break;
			default:
				data = content;
				console.log(testItem)
				break;
			}
			
			if (expectedOutput == data) {
				PFList.push("pass")
				passItems++;
				addLine = addLine.replace("%passfail%","pass").replace("%PASSFAIL%","PASS").replace("%response%",data);
				nextStepsLine = adviceFromStatus(200);
			} else {
				PFList.push("fail")
				addLine = addLine.replace("%passfail%","fail").replace("%PASSFAIL%","FAIL").replace("%response%",data);
				nextStepsLine = adviceFromStatus(data);
			}
			
		circle(PFList,testCounter)
		document.getElementById("testRowUl").innerHTML = addLine + document.getElementById("testRowUl").innerHTML
		document.getElementById("nextStepsRowUl").innerHTML = nextStepsLine + document.getElementById("nextStepsRowUl").innerHTML
	},"",JSON.stringify(testData[i].body))
	} // end for i
	
}

function circle(PFList,testCounter){
//https://www.codeblocq.com/2016/04/Create-a-Pie-Chart-with-HTML5-canvas/
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");

	var beginAngle = 0;
	var endAngle = 0;
	var offset = 0; //10

	var offsetX, offsetY, medianAngle;

	for (var i = 0;i < testCounter; i++) {
		if (PFList[i] == "pass") {
			ctx.fillStyle = "blue";
		} else {
			ctx.fillStyle = "red";
		}
		// Begin where we left off
		beginAngle = endAngle;
		// End Angle
		endAngle = endAngle + (Math.PI * 2/testCounter);

		// The medium angle is the average of two consecutive angles
		 medianAngle = (endAngle + beginAngle) / 2;
		// X and Y calculations
		offsetX = Math.cos(medianAngle) * offset;
		offsetY = Math.sin(medianAngle) * offset - 60;
		ctx.beginPath();
		// Adding the offsetX and offsetY to the center of the arc
		ctx.moveTo(200 + offsetX, 200 + offsetY);
		ctx.arc(200 + offsetX, 200 + offsetY, 120, beginAngle, endAngle);
		ctx.lineTo(200 + offsetX, 200 + offsetY);
		ctx.stroke();
		// Fill
		ctx.fill();
	}
}

function adviceFromStatus(status){
	switch(status){
		case 200:
			return "<li>Good to go.</li>";
			break;
		case " Error: Not Found":
			return "<li>File is missing. Try loading it</li>";
			break;
		case " Error: Method Not Allowed":
			return "<li>Method not allowed - do you have permissions?</li>";
			break;
		default:
			return "<li>Unknown error "+status+"</li>";
			break;
	}
}

/*

console.log(webResponse)
try {
	var contentSplit = (webResponse.content.split(" "))
	if (contentSplit[0] == "Bearer") {
		token = contentSplit[1]
	} else {
	}// end if contentSplit
} catch {
	token = "";
} //end try 
*/

window.onload = draw;

</script>
<style>
<!-- CSS CLASSES GO HERE -->
.blank {
}
.pass {
	color:blue
}
.fail {
	color:red
}
</style>
		<link href="https://www.Gilgamech.com/css/Gilgamech.css" rel="stylesheet" type="text/css">
		<link href="https://www.Gilgamech.com/css/bootstrap.min.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div id="content">

			<div id="jumbotron" class="jumbotron text-center" style="background: rgb(200, 0, 0);">
				<h1>Programmatic Webserver</h1>
				<h4>Test output page</h4>
			</div>
			<div id="container" class="container">
				<div id="cBanner" class="alert alert-info text-center">Build and test data.</div>
				<hr>
				<div id="cRow" class="row">
					<!-- Row 1 -->
					<div id="testRow" class="col-md-6">
					<h3>Server tests:</h3>
					<ol id="testRowUl">
					
					</ol>
					</div>
					<div id="pgRow" class="col-md-6">
					<canvas id="canvas" width="350vw" height="350vh"></canvas>
					</div>

					<!-- Row 2 -->
					<div id="nextStepsRow" class="col-md-6">
						<h3>Next Steps</h3>
						<ol id="nextStepsRowUl">
							</ol>
					</div>

					<div id="linksRow" class="col-md-6">
						<h3>Helpful Links</h3>
						<ul>
						<li><a href="https://Github.com/Gilgamech/ProgrammaticWebserver">Programmatic Webserver on Github</a></li>
						<li><a href="https://Hosting.Gilgamech.com/">Gilgamech Hosting</a></li>
						</ul>
					</div>
				</div>
			</div>

		</div><!-- End Content-->
		<div id="footWrapper">
			<div class="container-fluid">
			</div>
			<div id="spacerName">
				<br>
				<br>
			</div>
			<div id="errDiv" class="row img-rounded  img-rounded  col-md-12 col-xs-12 ">
			</div>
			<div id="footerStatic" class="navbar-static-bottom" style="text-align: center;">
				<p class="copyright">©2013-2023 Gilgamech Technologies - We are the gears that make our world go around.</p>
			</div>
		</div>
	</body>
</html>

